{
    "name": "Quiz Email Automation with Gmail",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "quiz-webhook",
          "responseMode": "responseNode",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Quiz Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [240, 300],
        "webhookId": "quiz-completed"
      },
      {
        "parameters": {
          "jsCode": "// Extract quiz data from webhook\nconst quizData = $input.first().json;\n\n// Validate required fields\nif (!quizData.name || !quizData.email || !quizData.quiz_type || quizData.score === undefined) {\n  throw new Error('Missing required fields: name, email, quiz_type, score');\n}\n\n// Generate personalized email content\nconst emailContent = generateEmailContent(quizData);\n\n// Set workflow variables for Gmail node\n$vars.set('toEmail', quizData.email);\n$vars.set('subject', emailContent.subject);\n$vars.set('htmlBody', emailContent.html);\n$vars.set('textBody', emailContent.text);\n$vars.set('patientName', quizData.name);\n$vars.set('quizType', quizData.quiz_type);\n$vars.set('quizScore', quizData.score);\n\nreturn {\n  quizData,\n  emailContent,\n  timestamp: new Date().toISOString()\n};\n\nfunction generateEmailContent(quizData) {\n  const { name, quiz_type, score, doctor_name, clinic_name } = quizData;\n  \n  // Quiz-specific content\n  const quizInfo = getQuizInfo(quiz_type, score);\n  \n  // Generate personalized message based on score\n  let scoreMessage = '';\n  let recommendation = '';\n  \n  if (score >= 8) {\n    scoreMessage = 'Your symptoms are severe and significantly impacting your quality of life.';\n    recommendation = 'We recommend scheduling a consultation as soon as possible to discuss treatment options.';\n  } else if (score >= 5) {\n    scoreMessage = 'Your symptoms are moderate and affecting your daily activities.';\n    recommendation = 'Consider scheduling a consultation to explore treatment options and symptom management strategies.';\n  } else {\n    scoreMessage = 'Your symptoms are mild and generally well-controlled.';\n    recommendation = 'Continue monitoring your symptoms and schedule a consultation if they worsen.';\n  }\n\n  return {\n    subject: `ðŸŽ¯ Your ${quizInfo.title} Results - Check Your Email!`,\n    html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; background: #f9f9f9;\">\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center;\">\n          <h1 style=\"margin: 0; font-size: 28px;\">ðŸŽ¯ ${quizInfo.title}</h1>\n          <p style=\"margin: 10px 0 0 0; font-size: 16px;\">Your personalized assessment results are ready!</p>\n        </div>\n        \n        <div style=\"padding: 30px; background: white;\">\n          <h2 style=\"color: #333;\">Hello ${name},</h2>\n          \n          <p style=\"color: #666; line-height: 1.6;\">Thank you for completing the <strong>${quizInfo.title}</strong> assessment. We've analyzed your responses and prepared personalized insights for you.</p>\n          \n          <div style=\"background: white; border: 3px solid #667eea; border-radius: 15px; padding: 25px; margin: 25px 0; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);\">\n            <div style=\"font-size: 52px; font-weight: bold; color: #667eea; margin: 15px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);\">${score}</div>\n            <p style=\"margin: 10px 0; color: #333;\"><strong>Your Total Score</strong></p>\n            <p style=\"margin: 10px 0; color: #666;\">${scoreMessage}</p>\n          </div>\n          \n          <h3 style=\"color: #333;\">ï¿½ï¿½ What This Means</h3>\n          <p style=\"color: #666; line-height: 1.6;\">${quizInfo.description}</p>\n          \n          <div style=\"background: #e8f4fd; border-left: 5px solid #2196f3; padding: 20px; margin: 25px 0; border-radius: 8px;\">\n            <h4 style=\"margin: 0 0 10px 0; color: #1976d2;\">ï¿½ï¿½ Recommendation</h4>\n            <p style=\"margin: 0; color: #1976d2; line-height: 1.6;\">${recommendation}</p>\n          </div>\n          \n          <h3 style=\"color: #333;\">ðŸ“‹ Next Steps</h3>\n          <ul style=\"color: #666; line-height: 1.6;\">\n            <li>Review your results and symptoms</li>\n            <li>Consider scheduling a consultation with ${doctor_name || 'our medical team'}</li>\n            <li>Monitor your symptoms over the next few days</li>\n            <li>Keep this email for your records</li>\n          </ul>\n          \n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"mailto:${clinic_name ? 'info@' + clinic_name.toLowerCase().replace(/\\s+/g, '') + '.com' : 'info@medicalpractice.com'}\" style=\"display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 18px 35px; text-decoration: none; border-radius: 30px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2);\">ðŸ“§ Contact Us</a>\n          </div>\n        </div>\n        \n        <div style=\"text-align: center; margin-top: 20px; color: #666; font-size: 14px; padding: 20px; background: #f0f0f0;\">\n          <p style=\"margin: 5px 0;\">This assessment is for informational purposes only and should not replace professional medical advice.</p>\n          <p style=\"margin: 5px 0;\">If you have urgent medical concerns, please contact your healthcare provider immediately.</p>\n        </div>\n      </div>\n    `,\n    text: `ðŸŽ¯ Your ${quizInfo.title} Results\\n\\nHello ${name},\\n\\nThank you for completing the ${quizInfo.title} assessment. Your total score is ${score}.\\n\\n${scoreMessage}\\n\\nRecommendation: ${recommendation}\\n\\nNext Steps:\\n- Review your results and symptoms\\n- Consider scheduling a consultation\\n- Monitor your symptoms\\n- Keep this email for your records\\n\\nThis assessment is for informational purposes only and should not replace professional medical advice.`\n  };\n}\n\nfunction getQuizInfo(quizType, score) {\n  const quizTypes = {\n    'TNSS': {\n      title: 'Total Nasal Symptom Score (TNSS)',\n      description: 'The TNSS is a validated 4-question assessment that evaluates the severity of your nasal allergy symptoms including nasal congestion, runny nose, nasal itching, and sneezing.',\n      scoreInterpretation: 'Scores range from 0-12, where 0-3 indicates mild symptoms, 4-7 indicates moderate symptoms, and 8-12 indicates severe symptoms.'\n    },\n    'SNOT22': {\n      title: 'SNOT-22 Assessment',\n      description: 'The SNOT-22 is a comprehensive 22-item questionnaire that measures the impact of sinonasal symptoms on your quality of life.',\n      scoreInterpretation: 'Scores range from 0-110, where 0-20 indicates minimal impact, 21-50 indicates moderate impact, and 51+ indicates severe impact on quality of life.'\n    },\n    'STOP': {\n      title: 'STOP Assessment',\n      description: 'The STOP assessment evaluates your risk of sleep apnea based on snoring, tiredness, observed apneas, and blood pressure.',\n      scoreInterpretation: 'Scores range from 0-4, where 0-1 indicates low risk and 2+ indicates high risk of sleep apnea.'\n    }\n  };\n\n  return quizTypes[quizType] || {\n    title: `${quizType} Assessment`,\n    description: 'This assessment helps evaluate your symptoms and provides personalized insights.',\n    scoreInterpretation: 'Your score indicates the severity of your symptoms and their impact on your daily life.'\n  };\n}"
        },
        "id": "process-quiz-data",
        "name": "Process Quiz Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [460, 300]
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "send",
          "to": "={{ $vars.get('toEmail') }}",
          "subject": "={{ $vars.get('subject') }}",
          "html": "={{ $vars.get('htmlBody') }}",
          "text": "={{ $vars.get('textBody') }}",
          "additionalFields": {}
        },
        "id": "send-gmail",
        "name": "Send Gmail",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 1,
        "position": [680, 300]
      },
      {
        "parameters": {
          "jsCode": "// Log the email sending result\nconst emailResult = $input.first().json;\nconst quizData = $('Process Quiz Data').first().json;\n\nconsole.log('Email sent successfully:', {\n  to: quizData.email,\n  quizType: quizData.quiz_type,\n  score: quizData.score,\n  timestamp: new Date().toISOString()\n});\n\nreturn {\n  success: true,\n  message: `Quiz result email sent to ${quizData.email}`,\n  quizData,\n  emailResult,\n  timestamp: new Date().toISOString()\n};"
        },
        "id": "log-success",
        "name": "Log Success",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [900, 300]
      }
    ],
    "connections": {
      "Quiz Webhook": {
        "main": [
          [
            {
              "node": "Process Quiz Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Quiz Data": {
        "main": [
          [
            {
              "node": "Send Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Gmail": {
        "main": [
          [
            {
              "node": "Log Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "createdAt": "2024-01-01T00:00:00.000Z",
        "updatedAt": "2024-01-01T00:00:00.000Z",
        "id": "quiz-email-gmail",
        "name": "Quiz Email Gmail"
      }
    ],
    "triggerCount": 1,
    "updatedAt": "2024-01-01T00:00:00.000Z",
    "versionId": "1"
  }